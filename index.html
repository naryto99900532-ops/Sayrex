<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Bobix Corporation - Главная</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Russo+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="grid-bg"></div>
    
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-crown logo-icon"></i>
                <div class="logo-text">BOBIX <span>CORPORATION</span></div>
            </div>
            <nav>
                <ul>
                    <li><a href="#home" class="active"><i class="fas fa-home"></i> Главная</a></li>
                    <li><a href="#thresholds"><i class="fas fa-layer-group"></i> Пороги</a></li>
                    <li><a href="#news"><i class="fas fa-newspaper"></i> Новости</a></li>
                    <li><a href="#top"><i class="fas fa-trophy"></i> Топ игроков</a></li>
                    <li><a href="#about"><i class="fas fa-info-circle"></i> О нас</a></li>
                    <li><button id="loginBtn" class="nav-login-btn"><i class="fas fa-sign-in-alt"></i> Log In</button></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="hero fade-in" id="home">
            <h1>ЭЛИТА SHINDO LIFE</h1>
            <p>Bobix Corporation объединяет сильнейших игроков Shindo Life, каждый из которых выбрал свой уникальный путь развития через систему порогов.</p>
            <button id="mainLoginBtn" class="btn">ВОЙТИ В СИСТЕМУ</button>
        </section>

        <section class="thresholds-info fade-in" id="thresholds">
            <h2>СИСТЕМА ПОРОГОВ</h2>
            <p><strong>Порог</strong> - это путь, который выбрал игрок и развивает свой порог, чтобы стать сильным.</p>
            
            <div class="threshold-types">
                <div class="threshold-card">
                    <div class="threshold-number">1</div>
                    <h3>Порог Силы</h3>
                    <p>Нанесение увечий, скорость нанесения увечий и урона.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">2</div>
                    <h3>Порог Меткости</h3>
                    <p>Путь и развитие меткости (Aim). Мастера этого порога поражают цели с невероятной точностью.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">3</div>
                    <h3>Порог Защиты</h3>
                    <p>Умение блокировать и парировать атаки противника.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">4</div>
                    <h3>Порог Скорости</h3>
                    <p>Управление темпом игры и быстрое использование комбо.</p>
                </div>
            </div>
        </section>

        <!-- НОВЫЙ РАЗДЕЛ: НОВОСТИ -->
        <section class="news-section fade-in" id="news">
            <h2 class="section-title">ПОСЛЕДНИЕ НОВОСТИ</h2>
            <div class="news-container" id="newsListIndex">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Загрузка новостей...</p>
                </div>
            </div>
        </section>

        <section class="top-players-section" id="top">
            <h2 class="section-title fade-in">ТОП ИГРОКОВ BOBIX CORPORATION</h2>
            <div class="players-container">
                <div class="player-card fade-in">
                    <div class="player-rank">TOP 1</div>
                    <div class="player-info">
                        <div class="player-avatar"><i class="fas fa-fire"></i></div>
                        <div><h3 class="player-name">Sayrex</h3></div>
                    </div>
                    <p class="player-description">Абсолютный чемпион с максимальным развитием порогов силы и меткости.</p>
                </div>
                
                <div class="player-card fade-in">
                    <div class="player-rank">TOP 2</div>
                    <div class="player-info">
                        <div class="player-avatar"><i class="fas fa-shield-alt"></i></div>
                        <div><h3 class="player-name">Marfet</h3></div>
                    </div>
                    <p class="player-description">Непробиваемый защитник с легендарными оборонительными способностями.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Модальное окно авторизации -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="authTitle">Вход в систему</h2>
            <form id="authForm">
                <div class="form-group">
                    <input type="email" id="email" placeholder="Электронная почта" required>
                </div>
                
                <div class="form-group reg-field" style="display:none">
                    <input type="text" id="username" placeholder="Ваш никнейм" required>
                </div>
                
                <div class="form-group">
                    <input type="password" id="password" placeholder="Пароль" required>
                </div>
                
                <div class="form-group reg-field" style="display:none">
                    <input type="password" id="confirmPass" placeholder="Повторите пароль" required>
                </div>
                
                <div id="authError" class="error-message" style="display:none;"></div>
                
                <button type="submit" id="submitBtn" class="btn-yellow">Войти</button>
                
                <div class="auth-footer">
                    <span id="toggleAuth">Нет аккаунта? Зарегистрироваться</span>
                    <a href="#" class="forgot-password">Забыли пароль?</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Модальное окно деталей новости (для главной страницы) -->
    <div id="newsDetailsModal" class="modal">
        <div class="modal-content news-modal-content">
            <span class="close-modal close-news-details">&times;</span>
            <div class="news-details-header">
                <h2 id="newsDetailsTitle">Заголовок новости</h2>
                <div class="news-details-meta">
                    <span id="newsDetailsAuthor"><i class="fas fa-user"></i> Автор</span>
                    <span id="newsDetailsDate"><i class="fas fa-calendar"></i> Дата</span>
                </div>
            </div>
            <div class="news-details-body" id="newsDetailsContent">
                <!-- Содержимое новости будет загружено динамически -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="db.js"></script>
    <script src="auth.js"></script>
    <script src="news.js"></script>
    <script>
        // Инициализация событий для кнопок входа
        document.addEventListener('DOMContentLoaded', function() {
            const loginBtn = document.getElementById('loginBtn');
            const mainLoginBtn = document.getElementById('mainLoginBtn');
            const closeModal = document.querySelector('.close-modal');
            const modal = document.getElementById('authModal');
            
            // Функция открытия модального окна
            function openAuthModal() {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; // Блокируем скролл
            }
            
            // Функция закрытия модального окна
            function closeAuthModal() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Возвращаем скролл
            }
            
            // Обработчики событий
            if (loginBtn) loginBtn.addEventListener('click', openAuthModal);
            if (mainLoginBtn) mainLoginBtn.addEventListener('click', openAuthModal);
            if (closeModal) closeModal.addEventListener('click', closeAuthModal);
            
            // Закрытие модального окна при клике вне его
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeAuthModal();
                }
            });
            
            // Закрытие модального окна по клавише Escape
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && modal.style.display === 'flex') {
                    closeAuthModal();
                }
            });


            /**
 * Отображение списка новостей
 * @param {Array} news - Массив новостей
 */
function renderNewsList(news) {
    const newsList = document.getElementById('newsList') || document.getElementById('newsListIndex');
    if (!newsList) return;
    
    if (!news || news.length === 0) {
        newsList.innerHTML = `
            <div class="threshold-card">
                <h3><i class="fas fa-newspaper"></i> Новостей пока нет</h3>
                <p>Будьте первым, кто опубликует новость!</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    news.forEach((newsItem, index) => {
        const authorName = newsItem.author?.username || 'Автор новости';
        const newsDate = new Date(newsItem.created_at).toLocaleDateString('ru-RU', {
            day: 'numeric',
            month: 'long',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        // Обрезаем текст для превью
        const previewText = newsItem.content.length > 150 
            ? escapeHtml(newsItem.content.substring(0, 150)) + '...' 
            : escapeHtml(newsItem.content);
        
        html += `
            <div class="news-card" onclick="if (typeof openNewsDetails === 'function') openNewsDetails('${newsItem.id}')">
                <div class="news-header">
                    <h3 class="news-title">${escapeHtml(newsItem.title)}</h3>
                    <div class="news-meta">
                        <span class="news-author"><i class="fas fa-user"></i> ${escapeHtml(authorName)}</span>
                        <span class="news-date"><i class="fas fa-calendar"></i> ${newsDate}</span>
                    </div>
                </div>
                <div class="news-content-preview">
                    ${previewText}
                </div>
                ${newsItem.image_urls && newsItem.image_urls.length > 0 ? `
                    <div class="news-images-preview">
                        <i class="fas fa-image"></i> ${newsItem.image_urls.length} изображений
                    </div>
                ` : ''}
                <div class="news-footer">
                    <span class="news-comments-count">
                        <i class="fas fa-comment"></i> ${newsItem.comments_count || 0} комментариев
                    </span>
                    <button class="news-read-more" onclick="event.stopPropagation(); if (typeof openNewsDetails === 'function') openNewsDetails('${newsItem.id}')">
                        Читать далее <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        `;
    });
    
    newsList.innerHTML = html;
}
            /**
 * Показать уведомление (базовая версия для index.html)
 * @param {string} message - Текст сообщения
 * @param {string} type - Тип сообщения
 */
function showNotification(message, type = 'info') {
    // Простой alert для index.html
    alert(message);
    
    // Или создаем уведомление если нужна красивая версия
    if (typeof window.showNotification === 'function') {
        // Используем существующую функцию из других файлов
        window.showNotification(message, type);
    }
}
            
            // Проверка текущей сессии пользователя
            async function checkCurrentSession() {
                try {
                    const { data: { user } } = await _supabase.auth.getUser();
                    if (user) {
                        // Если пользователь уже авторизован, скрываем кнопку входа
                        if (loginBtn) loginBtn.style.display = 'none';
                        if (mainLoginBtn) {
                            mainLoginBtn.innerHTML = '<i class="fas fa-tachometer-alt"></i> ПЕРЕЙТИ В ПАНЕЛЬ УПРАВЛЕНИЯ';
                            mainLoginBtn.onclick = () => window.location.href = 'management.html';
                        }
                    }
                } catch (error) {
                    console.error('Ошибка при проверке сессии:', error);
                }
            }
            
            checkCurrentSession();
            
            // Инициализация модуля новостей
            initializeNewsModule();
        });
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Инициализация новостей для главной страницы
        if (typeof initializeNewsModule === 'function') {
            initializeNewsModule();
        } else {
            console.log('Модуль новостей не загружен');
        }
        
        // Остальной код для главной страницы...
    });
</script>
</body>
</html>
